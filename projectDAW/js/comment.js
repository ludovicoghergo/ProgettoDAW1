let names = ["AARÓN", "ABELARDO", "ABRAÁM", "ABRAHÁN", "ADALBERTO ", "ADÁN", "ADOLPHO", "ADRIÁN", "AGAPETO", "AGAPITO", "AGUSTÍN", "ALANO", "ALARICO", "ALBERTO", "ALEJANDRO", "ALEJO", "ALFONSO", "ALFREDO", "ALPHONSO", "ÁLVARO", "AMADIS", "AMADO", "AMADOR", "AMANCIO", "AMANDO", "AMARANTO", "AMBROSIO", "AMIDIO", "AMILCAR", "ANACLETO", "ANBESSA", "ANDRÉS", "ANIBAL", "ANSELMO", "ANTONELLO", "ANTONIO", "APOLINAR", "ARMANDO", "ARNALDO", "ARSENIO", "ARTURO", "ASDRUBAL", "ATILIO", "AUGUSTO", "AURELIANO", "AURELIO", "BABIECA", "BAJARDO", "BALDOMERO", "BALDUINO", "BARTOLOMÉ", "BASILIO", "BAUTISTA", "BAYARDO", "BELTRÁN", "BENEDICTO", "BENITO", "BERENGUER", "BERMUDO", "BERNARDO", "BLAS", "BOLÍVAR", "BOLIVAR", "BUENAVENTURA", "CAMILO", "CANDELARIO", "CARLITO", "CARLITOS", "CARLOS", "CARMELO", "CASIMIRO", "CAYETANO", "CAYO", "CEBRIÁN", "CECILIO", "CELESTINO", "CELINO", "CELIO", "CELSO", "CÉSAR", "CHE", "CHICO", "CHUCHO", "CHUS", "CHUY", "CIRIACO", "CLAUDIO", "CLAVILENO", "CLEMENTE", "CLETO", "CLÍMACO", "CONRADO", "CRISTIÁN", "CRISTÓBAL", "CRUZ", "CURRO", "CUSTODIO", "DAMIÁN", "DEMETRIO", "DESI", "DESIDERIO", "DIEGO", "DIMAS", "DIONISIO", "DOMINGO", "DONATO", "DOROTEO", "EBERARDO", "EDGARDO", "EDMUNDO", "EDUARDO", "EFRAÍN", "ELADIO", "ELEUTERIO", "ELISEO", "ELOY", "ELPIDIO", "EMERICO", "EMIDIO", "EMIGDIO", "EMILIANO", "EMILIO", "EMYGDIO", "ENRIQUE", "ERMENEGILDO", "ERNESTO", "ESPIRIDIÓN", "ESSUA", "ESTAVAN", "ESTÉBAN", "EUGÈNIO", "EUGENIO", "EULÁLIO", "EURICO", "EUSBIO", "EUSEBIO", "EUSTAQUIO", "EUTIMIO", "EUTROPIO", "EZEQUIEL", "FABIÁN", "FABRICIO", "FARAMUNDO", "FAUSTINO", "FAUSTO", "FEDERICO", "FELICIANO", "FELIPE", "FERMÍN", "FERNÁN", "FERNÁNDO", "FIDEL", "FLAVIO", "FLORENCIO", "FONS", "FONSIE", "FRANCISCO", "FRASCUELO", "FRASQUITO", "FULGENCIO", "GABINO", "GAEL", "GASPAR", "GERALDO", "GERARDO", "GERMÁN", "GERVASI", "GERVASIO", "GIL", "GILBERTO", "GODOFREDO", "GOITO", "GONZALO", "GOYO", "GRACIANO", "GREGORIO", "GUALTIERO", "GUILERMO", "GUILLERMO", "GUIOMAR", "GUSTAVO", "HÉCTOR", "HELIODORO", "HERBERTO", "HERIBERTO", "HERMENEGILDO", "HERMINIO", "HERNÁN", "HERNANDO", "HIERONIMO", "HILARIO", "HIPOLITO", "HORACIO", "HUMBERTO", "IAGO", "IGNACIO", "ILDEFONSO", "IÑIGO", "INIGO", "IÑJGO", "INOCENCIO", "ISANDRO", "ISMAEL", "IUCEPH", "JACINTO", "JACOBO", "JAIME", "JAVIER", "JENARO", "JERÓNIMO", "JESÚS", "JOAQUIN", "JORGE", "JOSÉ", "JOSUE", "JUAN", "JUANITO", "JULIÁN", "JULIO", "JUNÍPERO", "LADISLAO", "LALO", "LEANDRO", "LEOCADIO", "LEÓN", "LEONARDO", "LEONCIO", "LEOPOLDO", "LINO", "LOPE", "LORENCIO", "LUCIO", "LUIS", "MACARIO", "MANOLETE", "MANOLITO", "MANOLO", "MANUEL", "MARCELINO", "MARCELO", "MARCIAL", "MARCIO", "MARCOS", "MARIO", "MARTÍN", "MATEO", "MAURICIO", "MAXIMIANO", "MAXIMILIANO", "MAXIMINO", "MÁXIMO", "MELCHOR", "MERLÍN", "MIGUEL", "MODESTO", "MOISÉS", "NACHO", "NACIO", "NARCISO", "NATALIO", "NATANAEL", "NAZARIO", "NICODEMO", "NICOLAO", "NICOLÁS", "NOVIO", "OCTAVIO", "ODALIS", "OLEGARIO", "ÓSCAR", "OSVALDO", "OVIDIO", "PABLO", "PACO", "PANCHO", "PAQUITO", "PASCUAL", "PASTOR", "PATRICIO", "PAULINO", "PEDRO", "PEPE", "PEPITO", "PINO", "PÍO", "PLÁCIDO", "PLINIO", "PONCIO", "PORFIRIO", "PRIMO", "PROSPERO", "PRUDENCIO", "QUIQUE", "RAFAEL", "RAIMUNDO", "RAINERIO", "RAMIRO", "RAMÓN", "RAÚL", "RAYMUNDO", "RÉGULO", "REINALDO", "REMIGIO", "RENATO", "REYES", "REYNALDO", "RICARDO", "RICO", "ROBERTO", "RODOLFO", "RODRIGO", "ROGELIO", "ROGERIO", "ROLANDO", "ROLDÁN", "ROMÁN", "ROQUE", "ROSARIO", "RUBÉN", "RUFINO", "RUPERTO", "RUY", "SABAS", "SAL", "SALOMÓN", "SALVADOR", "SANCHO", "SANDALIO", "SANS", "SANTIAGO", "SANTOS", "SATURNINO", "SAULO", "SEBASTIÁN", "SERGIO", "SEVE", "SEVERIANO", "SEVERINO", "SEVERO", "SILVESTRE", "SILVIO ", "SIMÓN", "SOFRONIO", "SOSIMO", "TACITO", "TADEO", "TEOBALDO", "TEODORO", "TEODOSIO", "TEÓDULO", "TEÓFILO", "TERCERO", "TIBURCIO", "TIMOTEO", "TITO", "TOMÁS", "TONIO", "TOÑO", "TRINIDAD", "TRISTÁN", "ULISES", "URBANO", "VALENTÍN", "VALERIANO", "VALERIO", "VASCO", "VELASCO", "VENCESLÁS", "VICENTE", "VÍCTOR", "VICTORINO", "VIDAL", "VINCENÇ", "VINICIO", "VIRGILIO", "VITO", "WILFREDO", "XIMEN", "XIMENEZ", "ZACARÍAS"];
let regularContent = '\n<img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">\n<div class="media-body">\n  <h5 class="mt-0">Commenter Name</h5>\n  <p></p>\n</div>';
let alert = '<div class="alert alert-danger">\n<strong>Error!</strong> Message can not be empty!\n</div>';
let i = 0;
let the_object=null;
let content;
let commentId;
let req_get = new XMLHttpRequest();
let req_put = new XMLHttpRequest();
let url = "https://api.jsonbin.io/b/5dd2b5d0ad952a6f46ce3aff";
req_get.onreadystatechange = handle_json;
req_get.open("GET", url);
req_get.setRequestHeader("secret-key", "$2b$10$CwGL6myH0Hc1h3HRcEJHQuwa9u25Q2pT7/6to2MTUnyBoWBk2ClP.");
req_get.send(null);
async function reload(){
    location.reload();
}
function print_comments(the_object){
    //console.log(the_object);
    $('.comment').remove();
    for (let i = 0; i < the_object.commentId.length; i++) {
        let commentId = 'comment' + the_object.commentId[i].i
        $("#commentForm").after($('<div></div>', {
            id: commentId,
            class: 'media mb-4 comment'
        }));
        $('#' + commentId).append(regularContent);
        $('#' + commentId + " h5").text(the_object.commentId[i].author);
        $('#' + commentId + " p").text(the_object.commentId[i].content);
    }
}
function handle_json() {
    if (req_get.readyState == 4) {
        if (req_get.status == 200) {
            let json_data = req_get.responseText; // text download
            the_object = JSON.parse(json_data); // change text to JSON
            print_comments(the_object);
        } else {
            alert('URL Error');
        }
    }
}

function chooseName() {
    return names[Math.floor(Math.random() * (names.length + 1)) + 0];
}

async function generateObject() {
    req_put.open("PUT", url, true);
    req_put.setRequestHeader("Content-type", "application/json");
    req_put.setRequestHeader("secret-key", "$2b$10$CwGL6myH0Hc1h3HRcEJHQuwa9u25Q2pT7/6to2MTUnyBoWBk2ClP.");
    req_put.setRequestHeader("versioning", "false");
    content = $("#comment-content");
    commentId = 'comment' + the_object.commentId.length;
    if (content.val() !== '') {
        $(".alert").remove();
        the_object.commentId.push(JSON.parse(JSON.stringify({i: ''+the_object.commentId.length, author: ''+chooseName(), content: ''+content.val()})));
        //console.log(the_object);
        req_put.send(JSON.stringify(the_object));
        //console.log(promise1);
        content.val('');
    } else if (!$(".alert").length) $("#commentForm").after(alert);
}
$("#commentButton").on("click", ()=>{
generateObject();
setTimeout(location.reload.bind(location), 300);
});




